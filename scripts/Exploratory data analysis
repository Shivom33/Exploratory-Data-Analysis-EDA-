
print'========================================================='
print'Exploratory Data Analysis (EDA) in SQL'
print'Project: Data Exploratory Analysis'
print' Author : Aman Tyagi'
print'=========================================================='
/*
 This script is a starting template for performing
 Exploratory Data Analysis (EDA) using SQL.

 Steps Covered:
 1. Data Exploration & Dimension Exploration
 2. Measures Exploration
 3. Magnitude Analysis
 4. Ranking Analysis

=========================================================
*/

  print' ============================'
  print 'STEP 1: DATA EXPLORATION'
  print' ============================'

   --Explore all objects in the Database

   SELECT * FROM INFORMATION_SCHEMA.TABLES

   --Explore all the columns in the Database

   SELECT * FROM INFORMATION_SCHEMA.COLUMNS
   WHERE TABLE_NAME = 'dim.customers'

   print' ============================'
   print 'STEP 2: DIMENSION EXPLORATION'
   print '============================'

   --Explore all the countries our customers are from
   SELECT distinct country FROM gold.dim_customers

   --Explore All the categories "The major Division"
   SELECT distinct category, subcategory,product_name FROM gold.dim_products
   ORDER BY 1,2,3

   print'-------------------------'
   print' Date Exploration'
   print'---------------------------'

   --Find the date of the first and the last order

   SELECT MIN(order_date) AS First_order_date,
   MAX(order_date) AS Last_order_date
   FROM gold.fact_sales

   --How many years of Sales are Available

   SELECT DATEDIFF(YEAR, min(order_date), max(order_date))
   AS Total_years_of_sale 
   FROM gold.fact_sales

   --Find the youngest and the oldest customer

   SELECT DATEDIFF(YEAR,MIN(birthdate),GETDATE()) AS Oldest_customer,
   DATEDIFF(YEAR,MAX(birthdate),GETDATE()) AS Youngest_customer
   FROM gold.dim_customers

  print '============================'
  print 'STEP 3: MEASURES EXPLORATION'
  print '============================'

  --Find the total Sales
  SELECT SUM(Sales_amount) AS total_sales FROM gold.fact_sales
  --Find how many items are sold
   SELECT SUM(quantity) AS total_quantity FROM gold.fact_sales
  --Find the average selling Price
   SELECT AVG(price) AS Average_selliing_price FROM gold.fact_sales
  --Find the total Number of Orders
  SELECT count(DISTINCT(order_number)) AS Total_Orders FROM gold.fact_sales
  --Find the total number of Products
  SELECT count(DISTINCT(product_name)) AS Total_products FROM gold.dim_products
  --Find the total number of Customers
  SELECT count(DISTINCT(customer_key)) AS Total_customers FROM gold.dim_customers
  --Find the total number of customers that has placed an Order
  SELECT count(DISTINCT(customer_key)) AS Total_customers FROM gold.fact_sales

 --Generate the report that shows all the key metric of the reports

 SELECT 'Total_Sale' as Measure_name, SUM(Sales_amount) AS measure_value FROM gold.fact_sales
 UNION ALL
 SELECT 'Total_Quantity' as measure_name ,SUM(quantity) AS measure_value FROM gold.fact_sales
 UNION ALL
 SELECT 'Average_selliing_price' as measure_name, AVG(price) AS measure_value FROM gold.fact_sales
 UNION ALL
 SELECT 'Total_Orders' as measure_name, count(DISTINCT(order_number)) AS measure_value FROM gold.fact_sales
 UNION ALL
 SELECT 'Total_product' as measure_name, count(DISTINCT(product_name)) AS measure_value FROM gold.dim_products
 UNION ALL
  SELECT 'Total_customers' as measure_name, count(DISTINCT(customer_key)) AS measure_value FROM gold.dim_customers
UNION ALL
SELECT'Total_customers_who_placed_orders' as measure_name, count(DISTINCT(customer_key)) AS measure_value FROM gold.fact_sales

 print '============================'
 print 'STEP 4: MAGNITUTDE ANALYSIS'
 print '============================'

 -- Find the total customers by countries

 SELECT country, count(customer_key) AS total_customers
 FROM gold.dim_customers group by country

 -- Find total custommers by gender

 SELECT gender, count(customer_key) AS customers
 FROM gold.dim_customers group by gender
 -- Find total products by category
 SELECT SUM(product_key) AS total_products, category 
 FROM gold.dim_products group by category order by SUM(product_key)  DESC 

 -- What is the average costs in each Category

 SELECT avg(cost) AS total_products, category 
 FROM gold.dim_products group by category
 order by avg(cost)  DESC 

 -- What is the total revenue generated by each category

 SELECT 
 p.category,SUM(s.sales_amount) AS total_revenue
  FROM gold.dim_products p
 LEFT JOIN gold.fact_sales s
 ON p.product_key = s.product_key
 GROUP BY category order by total_revenue DESC

 -- Find the total Revenue generated by each Customer

 SELECT c.customer_key,
 c.first_name,c.last_name, SUM(s.sales_amount) as total_revenue FROM gold.fact_sales s
 LEFT JOIN gold.dim_customers c
 ON s.customer_key = c.customer_key
 GROUP BY c.customer_key,
 c.first_name,c.last_name Order by total_revenue DESC

 -- What is the distribution of sold items across Countries

SELECT c.country, SUM(s.quantity) as total_sold_items FROM gold.fact_sales s
 LEFT JOIN gold.dim_customers c
 ON s.customer_key = c.customer_key
 GROUP BY c.country Order by total_sold_items DESC

 print '============================'
 print 'STEP 5: RANKING ANALYSIS'
 print '============================'

 --Which 5 products generate the highest Revenue?

  SELECT TOP 5
 p.product_name,SUM(s.sales_amount) AS total_revenue
  FROM gold.dim_products p
 LEFT JOIN gold.fact_sales s
 ON p.product_key = s.product_key
 GROUP BY product_name order by total_revenue DESC

--What are the 5 worst performing products in the terms of sales

 SELECT TOP 5
 p.product_name,SUM(s.sales_amount) AS total_revenue
  FROM gold.dim_products p
 LEFT JOIN gold.fact_sales s
 ON p.product_key = s.product_key
 GROUP BY product_name order by total_revenue ASC

 
 --Find the TOP 10 customers who have generated the highest revenue

 SELECT TOP 10 c.customer_key,
 c.first_name,c.last_name, SUM(s.sales_amount) as total_revenue FROM gold.fact_sales s
 LEFT JOIN gold.dim_customers c
 ON s.customer_key = c.customer_key
 GROUP BY c.customer_key,
 c.first_name,c.last_name Order by total_revenue DESC
